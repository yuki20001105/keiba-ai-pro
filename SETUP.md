# ç«¶é¦¬AI Pro - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ðŸ“‹ å‰ææ¡ä»¶

- Node.js 18ä»¥ä¸Š
- npm ã¾ãŸã¯ yarn
- Supabaseã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Stripeã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆèª²é‡‘æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
- Google Cloud Platform ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆOCRæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
- OpenAI APIã‚­ãƒ¼ ã¾ãŸã¯ Google Gemini APIã‚­ãƒ¼ï¼ˆAIè£œæ­£ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

## ðŸš€ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.local.example`ã‚’`.env.local`ã«ã‚³ãƒ”ãƒ¼:

```bash
copy .env.local.example .env.local  # Windows
# ã¾ãŸã¯
cp .env.local.example .env.local    # macOS/Linux
```

`.env.local`ã‚’ç·¨é›†ã—ã¦å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

### 3. Supabaseã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 3.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1. [Supabase](https://supabase.com)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®URL ã¨ anon key ã‚’`.env.local`ã«è¿½åŠ 

#### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒžã®é©ç”¨

Supabase ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã€ŒSQL Editorã€ã§ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é †ç•ªã«å®Ÿè¡Œ:

1. `supabase/schema.sql` - åŸºæœ¬ã‚¹ã‚­ãƒ¼ãƒžï¼ˆprofiles, predictions, bets, bank_records, ocr_usageï¼‰
2. `supabase/race_schema.sql` - ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒžï¼ˆraces, race_results, race_odds, race_payouts, ml_modelsï¼‰

#### 3.3 Authenticationè¨­å®š

1. Authentication > Providers ã§Emailèªè¨¼ã‚’æœ‰åŠ¹åŒ–
2. Email Templates ã‚’æ—¥æœ¬èªžåŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### 4. Stripeã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆèª²é‡‘æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

#### 4.1 ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆä½œæˆ

1. [Stripe Dashboard](https://dashboard.stripe.com)ã«ãƒ­ã‚°ã‚¤ãƒ³
2. Products > Add Product
   - Name: Premium Plan
   - Price: Â¥1,980/æœˆ
   - Recurring: Monthly
3. ä½œæˆã—ãŸPrice IDã‚’`.env.local`ã®`STRIPE_PRICE_ID_PREMIUM`ã«è¨­å®š

#### 4.2 Webhookè¨­å®š

1. Developers > Webhooks > Add endpoint
2. Endpoint URL: `https://your-domain.com/api/stripe/webhook`
3. Events to send:
   - `checkout.session.completed`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
4. Signing secret ã‚’`.env.local`ã®`STRIPE_WEBHOOK_SECRET`ã«è¨­å®š

### 5. Google Vision API ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆOCRæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

#### 5.1 GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1. [Google Cloud Console](https://console.cloud.google.com)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
3. Vision API ã‚’æœ‰åŠ¹åŒ–

#### 5.2 ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

1. IAM & Admin > Service Accounts
2. Create Service Account
3. Role: Cloud Vision API User
4. Create Key (JSONå½¢å¼)
5. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«é…ç½®
6. `.env.local`ã®`GOOGLE_APPLICATION_CREDENTIALS`ã«ãƒ‘ã‚¹ã‚’è¨­å®š

### 6. OpenAI / Gemini API ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆAIè£œæ­£ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

#### OpenAI

1. [OpenAI Platform](https://platform.openai.com)ã§APIã‚­ãƒ¼ã‚’å–å¾—
2. `.env.local`ã®`OPENAI_API_KEY`ã«è¨­å®š

#### Google Gemini

1. [Google AI Studio](https://makersuite.google.com/app/apikey)ã§APIã‚­ãƒ¼ã‚’å–å¾—
2. `.env.local`ã®`GOOGLE_GEMINI_API_KEY`ã«è¨­å®š

### 7. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
npm run dev
```

http://localhost:3000 ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## ðŸ“Š æ©Ÿèƒ½ã®ä½¿ã„æ–¹

### 1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

1. ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€Œæ–°è¦ç™»éŒ²ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ç™»éŒ²
3. è‡ªå‹•çš„ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™

### 2. ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆnetkeibaã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼‰

1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ã€ã‚’é¸æŠž
2. å¹´æœˆã‚’é¸æŠžã—ã¦é–‹å‚¬æ—¥ã‚’å–å¾—
3. å–å¾—ã—ãŸã„é–‹å‚¬æ—¥ã‚’é¸æŠžã—ã¦ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ã‚’å–å¾—
4. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠž
5. ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

**æ³¨æ„**: netkeibaã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–ã®ãŸã‚ã€1ãƒ¬ãƒ¼ã‚¹ã‚ãŸã‚Šç´„3ç§’ã‹ã‹ã‚Šã¾ã™ã€‚

### 3. AIäºˆæ¸¬

1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã€Œä¸€æ‹¬äºˆæ¸¬ãƒ»è³¼å…¥æŽ¨å¥¨ã€ã‚’é¸æŠž
2. è³‡é‡‘ç®¡ç†è¨­å®šã‚’èª¿æ•´:
   - ç·è³‡é‡‘: 10,000å†† - 10,000,000å††
   - ãƒªã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰: ä¿å®ˆçš„(2%) / ãƒãƒ©ãƒ³ã‚¹(3.5%) / ç©æ¥µçš„(5%)
   - ã‚±ãƒªãƒ¼åŸºæº–ã®ä½¿ç”¨: ON/OFF
   - æœ€ä½ŽæœŸå¾…å€¤ãƒ•ã‚£ãƒ«ã‚¿: 1.0 - 3.0å€
3. ã€Œãƒ¬ãƒ¼ã‚¹é¸æŠžã€ã‚¿ãƒ–ã§é–‹å‚¬æ—¥ã¨ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠž
4. ã€Œä¸€æ‹¬äºˆæ¸¬ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ã€Œãƒ¬ãƒ¼ã‚¹è©³ç´°ã€ã‚¿ãƒ–ã§äºˆæ¸¬çµæžœã‚’ç¢ºèª

### 4. OCRé¦¬åˆ¸ã‚¹ã‚­ãƒ£ãƒ³

1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã€ŒOCRã‚¹ã‚­ãƒ£ãƒ³ã€ã‚’é¸æŠž
2. é¦¬åˆ¸ã®å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. è‡ªå‹•èªè­˜ã•ã‚ŒãŸæƒ…å ±ã‚’ç¢ºèª
4. å¿…è¦ã«å¿œã˜ã¦ã€ŒAIè£œæ­£ã€ã‚’å®Ÿè¡Œï¼ˆBOXãƒ»ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
5. ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜

**åˆ©ç”¨åˆ¶é™**:
- Freeãƒ—ãƒ©ãƒ³: æœˆ10å›ž
- Premiumãƒ—ãƒ©ãƒ³: æœˆ1,000å›ž

### 5. è³‡é‡‘ç®¡ç†ãƒ»åˆ†æž

1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ä»¥ä¸‹ã®æƒ…å ±ã‚’ç¢ºèª:
   - ç¾åœ¨ã®è³‡é‡‘
   - å›žåŽçŽ‡
   - ROIï¼ˆæŠ•è³‡åŽç›ŠçŽ‡ï¼‰
   - å‹çŽ‡
2. ã‚°ãƒ©ãƒ•ã§æ—¥æ¬¡åŽæ”¯ã¨é¦¬åˆ¸ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒã‚’ç¢ºèª
3. æœ€è¿‘ã®è³­ã‘å±¥æ­´ã‚’ç¢ºèª

### 6. ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã€Œã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã€ã‚’é¸æŠž
2. Stripe Checkoutã§æ”¯æ‰•ã„æƒ…å ±ã‚’å…¥åŠ›
3. æ±ºæ¸ˆå®Œäº†å¾Œã€è‡ªå‹•çš„ã«OCRåˆ©ç”¨åˆ¶é™ãŒ1,000å›žã«æ‹¡å¼µã•ã‚Œã¾ã™

## ðŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šã‚¨ãƒ©ãƒ¼

- Supabase URLã¨APIã‚­ãƒ¼ãŒæ­£ã—ã„ã‹ç¢ºèª
- Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒç¨¼åƒä¸­ã‹ç¢ºèª

### OCRãŒå‹•ä½œã—ãªã„

- Google Vision APIãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ç¢ºèª
- ç’°å¢ƒå¤‰æ•°`GOOGLE_APPLICATION_CREDENTIALS`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### Stripe WebhookãŒå‹•ä½œã—ãªã„

- Webhook URLãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆhttpså¿…é ˆï¼‰
- Webhookç½²åã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒæ­£ã—ã„ã‹ç¢ºèª
- Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‚’ç¢ºèª

### ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒå¤±æ•—ã™ã‚‹

- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæŽ¥ç¶šã‚’ç¢ºèª
- netkeibaãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã§ãªã„ã‹ç¢ºèª
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«å¼•ã£ã‹ã‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§ â†’ æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œ

### äºˆæ¸¬çµæžœãŒè¡¨ç¤ºã•ã‚Œãªã„

- ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- Supabaseã§ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

## ðŸ“ é–‹ç™ºè€…å‘ã‘æƒ…å ±

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/              # APIãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ predict/      # AIäºˆæ¸¬
â”‚   â”‚   â”œâ”€â”€ ocr/          # OCRã‚¹ã‚­ãƒ£ãƒ³
â”‚   â”‚   â”œâ”€â”€ ai-correct/   # AIè£œæ­£
â”‚   â”‚   â”œâ”€â”€ stripe/       # Stripeæ±ºæ¸ˆ
â”‚   â”‚   â””â”€â”€ netkeiba/     # netkeibaã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
â”‚   â”œâ”€â”€ auth/             # èªè¨¼ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ dashboard/        # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ data-collection/  # ãƒ‡ãƒ¼ã‚¿å–å¾—
â”‚   â”œâ”€â”€ predict-batch/    # ä¸€æ‹¬äºˆæ¸¬
â”‚   â””â”€â”€ ocr/              # OCRã‚¹ã‚­ãƒ£ãƒ³
â””â”€â”€ lib/
    â”œâ”€â”€ supabase.ts       # Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
    â”œâ”€â”€ stripe.ts         # Stripeã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
    â”œâ”€â”€ keiba-ai.ts       # ç«¶é¦¬AIäºˆæ¸¬ã‚¨ãƒ³ã‚¸ãƒ³
    â””â”€â”€ betting-strategy.ts # è³­ã‘æˆ¦ç•¥é–¢æ•°
```

### ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚º

#### äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã®æ”¹å–„

`src/lib/keiba-ai.ts`ã®`calculateHorseScore`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç·¨é›†ã—ã¦ã€ç‹¬è‡ªã®è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

#### è³‡é‡‘ç®¡ç†æˆ¦ç•¥ã®èª¿æ•´

`src/lib/betting-strategy.ts`ã®å„é–¢æ•°ã‚’ç·¨é›†ã—ã¦ã€ã‚±ãƒªãƒ¼åŸºæº–ã‚„ãƒ¬ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«åˆ¤å®šã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã§ãã¾ã™ã€‚

#### UIã®ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚º

Tailwind CSSã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€`tailwind.config.ts`ã§ãƒ†ãƒ¼ãƒžã‚«ãƒ©ãƒ¼ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚

## ðŸ†˜ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°
2. Next.jsã®ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
3. Supabaseã®ãƒ­ã‚°ï¼ˆDashboard > Logsï¼‰
4. Stripeã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ï¼ˆDashboard > Developers > Eventsï¼‰

## ðŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
