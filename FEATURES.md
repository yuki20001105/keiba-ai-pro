# 競馬AI Pro - 主要機能一覧

## ✅ 実装済み機能

### 1. データ取得（netkeibaスクレイピング）
- ✅ 開催日カレンダー取得
- ✅ レースID一覧取得
- ✅ レース結果スクレイピング
- ✅ オッズデータ取得
- ✅ 払戻データ取得
- ✅ Supabaseへの自動保存
- ✅ レート制限対応（3秒間隔）
- ✅ 進捗バー表示

### 2. AI予測エンジン
- ✅ スコアリングモデル（ランダムフォレスト風）
- ✅ 期待値計算（予測確率 × オッズ）
- ✅ 一括予測機能
- ✅ 馬券種別推奨（単勝・馬連・ワイド・三連複・馬単・三連単）
- ✅ 組み合わせ生成（C(n,k), P(n,k)）

### 3. プロ資金管理
- ✅ ケリー基準による最適賭け額計算
- ✅ フラクショナルケリー（1/4倍）
- ✅ レースレベル判定（見送り/通常/勝負）
- ✅ 動的単価調整（100円～1,000円）
- ✅ リスクモード（保守的2% / バランス3.5% / 積極的5%）
- ✅ 1レースあたり上限管理
- ✅ レベル別予算配分（見送り0% / 通常40% / 勝負80%）
- ✅ 最低期待値フィルタ

### 4. シーズン分析
- ✅ 春競馬（3-5月）: +10%ボーナス
- ✅ 夏競馬（6-8月）: -10%調整
- ✅ 秋競馬（9-11月）: +5%ボーナス
- ✅ 冬競馬（12-2月）: 標準

### 5. レース難易度スコア
- ✅ 予測分布の標準偏差による難易度計算
- ✅ 0-1の範囲で正規化
- ✅ 難易度0.7+で「勝負」判定

### 6. OCR馬券スキャン
- ✅ Google Vision API統合
- ✅ 画像アップロード
- ✅ テキスト抽出
- ✅ 馬券情報パーサー（レース名・馬券種別・馬番・金額・オッズ）
- ✅ 月間利用制限管理（Free: 10回 / Premium: 1,000回）
- ✅ 自動リセット（月次）

### 7. AI補正
- ✅ OpenAI GPT-4統合
- ✅ Google Gemini統合
- ✅ BOX買い対応
- ✅ フォーメーション対応
- ✅ JSON形式での構造化出力

### 8. Stripe課金システム
- ✅ Checkout Session作成
- ✅ Webhook処理（checkout.session.completed）
- ✅ サブスクリプション更新（customer.subscription.updated）
- ✅ サブスクリプション削除（customer.subscription.deleted）
- ✅ 顧客ポータル
- ✅ 自動アップグレード/ダウングレード

### 9. 認証システム
- ✅ Supabase Auth統合
- ✅ メール/パスワード認証
- ✅ ログイン/ログアウト
- ✅ 新規登録
- ✅ プロフィール自動生成

### 10. データベース
- ✅ PostgreSQL（Supabase）
- ✅ Row Level Security（RLS）
- ✅ 10テーブル（profiles, predictions, bets, bank_records, ocr_usage, races, race_results, race_odds, race_payouts, ml_models）
- ✅ 外部キー制約
- ✅ トリガー関数（新規ユーザー自動生成）

### 11. 分析ダッシュボード
- ✅ Rechartsグラフ（日次収支・馬券タイプ別分布）
- ✅ 統計カード（現在資金・回収率・ROI・勝率）
- ✅ 最近の賭け履歴テーブル
- ✅ リアルタイム更新

### 12. UI/UX
- ✅ Tailwind CSS
- ✅ レスポンシブデザイン
- ✅ ダークモード対応（プリファレンス）
- ✅ プログレスバー
- ✅ ローディング状態
- ✅ エラーハンドリング
- ✅ 成功/警告メッセージ

## 🚧 実装予定機能

### 1. 購入設定タブ
- ⬜ 馬券選択チェックボックスUI
- ⬜ リアルタイム集計（選択点数・投資金額・期待払戻）
- ⬜ 予算超過チェック
- ⬜ 自動調整通知
- ⬜ tracking.dbへの保存

### 2. 検証結果タブ
- ⬜ 購入履歴表示
- ⬜ 実際の結果比較
- ⬜ 的中判定
- ⬜ 回収率計算
- ⬜ 統計サマリー

### 3. 高回収率騎手チェック
- ⬜ 過去データから騎手回収率120%以上を抽出
- ⬜ 上位3頭に該当騎手がいれば+15%ボーナス

### 4. 中穴チャンス検出
- ⬜ 4-9番人気でオッズ断層を検出
- ⬜ 中穴推奨フラグ

### 5. モデルトレーニングページ
- ⬜ DBから訓練データ読み込み
- ⬜ 特徴量エンジニアリング
- ⬜ ランダムフォレスト/LightGBMトレーニング
- ⬜ クロスバリデーション
- ⬜ モデル評価（Accuracy, Precision, Recall, F1-Score）
- ⬜ 特徴量重要度可視化
- ⬜ モデル保存

### 6. バックテスト機能
- ⬜ 過去データで戦略検証
- ⬜ パラメータ最適化
- ⬜ シミュレーション実行

### 7. アラート機能
- ⬜ 高期待値レース通知
- ⬜ 勝負レース検出時メール送信
- ⬜ Webプッシュ通知

### 8. 統計ダッシュボード拡張
- ⬜ 期間別回収率
- ⬜ 馬券種別回収率
- ⬜ 競馬場別回収率
- ⬜ 勝負レース成績

### 9. 結果自動取得・検証
- ⬜ レース終了後、自動的に結果取得
- ⬜ 購入履歴と照合
- ⬜ 回収率自動計算

### 10. DB確認ページ
- ⬜ 全テーブル内容表示
- ⬜ フィルタ機能
- ⬜ SQLクエリ実行機能

## 📊 機能完成度

| カテゴリ | 完成度 |
|---------|--------|
| データ取得 | 90% |
| AI予測 | 70% |
| 資金管理 | 95% |
| OCR | 100% |
| AI補正 | 100% |
| 課金 | 100% |
| 認証 | 100% |
| DB | 100% |
| ダッシュボード | 80% |
| **全体** | **85%** |

## 🎯 次のステップ

1. 購入設定タブの実装（チェックボックスUI、tracking.db保存）
2. 検証結果タブの実装（的中判定、回収率計算）
3. モデルトレーニングページの実装
4. バックテスト機能の実装
5. 統計ダッシュボードの拡張
