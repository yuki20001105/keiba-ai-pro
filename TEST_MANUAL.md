# 競馬AI Pro - 機能テスト手順書

## 現在の起動状況
✅ Next.js: http://localhost:3000 (起動中)
✅ Ultimate版スクレイピングサービス: http://localhost:8001 (起動中)

## テスト手順

### 1. ログイン・ホーム画面の確認
1. ブラウザで http://localhost:3000 を開く
2. ログイン画面が表示される
3. ログイン後、ホーム画面に以下が表示されていることを確認:
   - Ultimate Mode トグルスイッチ（右上）
   - データ取得、モデル学習、予測実行などのメニュー

### 2. データ取得機能のテスト
1. 「データ取得」をクリック
2. Ultimate Mode を **ON** にする
3. 単一レースID取得をテスト:
   - レースID: `202401041001` を入力
   - 「取得」ボタンをクリック
   - 約30秒待つ
   - レースデータが正常に取得できることを確認
     - レース名: "3歳未勝利" など
     - 距離: "1200m" など
     - 出走頭数: 16頭など

### 3. 期間指定データ取得のテスト
1. データ取得画面で「期間指定で取得」を選択
2. 設定:
   - 開始: 2024年1月
   - 終了: 2024年1月
   - Ultimate Mode: ON
3. 「一括取得開始」をクリック
4. 進捗が表示されることを確認
5. データベースに保存されることを確認

### 4. モデル学習のテスト（データ取得後）
1. 「モデル学習」をクリック
2. Ultimate Mode が自動的に ON になっていることを確認
3. 設定:
   - ターゲット: 単勝 (win)
   - モデルタイプ: LightGBM
   - テストサイズ: 0.2
4. 「学習開始」をクリック
5. 学習が完了し、精度が表示されることを確認

### 5. 予測機能のテスト（学習後）
1. 「予測実行」をクリック
2. Ultimate Mode が自動的に ON になっていることを確認
3. レースID: `202401041001` を入力
4. 学習したモデルを選択
5. 「予測実行」をクリック
6. 予測結果が表示されることを確認:
   - 各馬の勝率
   - 推奨購入馬券

### 6. Global Ultimate Mode の動作確認
1. ホーム画面でUltimate Mode を ON
2. データ取得ページに移動 → Ultimate Mode が ON のまま
3. 学習ページに移動 → Ultimate Mode が ON のまま
4. 予測ページに移動 → Ultimate Mode が ON のまま
5. ホーム画面に戻り、Ultimate Mode を OFF
6. 各ページでも OFF になっていることを確認

## 予想される問題と解決策

### 問題1: レースデータが取得できない
原因: Ultimate版サービスが停止している可能性
解決策: 
```powershell
cd C:\Users\yuki2\Documents\ws\keiba-ai-pro
C:\Users\yuki2\Documents\ws\keiba\Scripts\python.exe scraping_service_ultimate_fast.py
```

### 問題2: ログインできない
原因: Supabase設定の問題
解決策: .env.local ファイルの確認

### 問題3: データが保存されない
原因: データベース接続の問題
解決策: Supabaseの設定とネットワーク接続を確認

### 問題4: 学習ができない
原因: データが不足している
解決策: まず十分なデータを取得してから学習を実行

## 各機能の期待される動作時間

- 単一レース取得（高速モード）: 約15-30秒
- 単一レース取得（詳細モード）: 約60-120秒
- 期間指定取得（1ヶ月）: 約30-60分
- モデル学習: 約1-5分（データ量による）
- 予測実行: 約30-60秒

## テスト完了チェックリスト

- [ ] ログイン成功
- [ ] ホーム画面表示
- [ ] Ultimate Mode トグル動作
- [ ] 単一レース取得成功
- [ ] レースデータ詳細表示
- [ ] 期間指定取得開始
- [ ] データベース保存確認
- [ ] モデル学習開始
- [ ] 学習完了・精度表示
- [ ] 予測実行成功
- [ ] 予測結果表示
- [ ] Global Mode の同期確認

## 動作確認用のテストレースID

2024年の実在するレース:
- 202401041001 (2024/1/4 中山1R)
- 202401041101 (2024/1/4 中京1R)
- 202401041201 (2024/1/4 小倉1R)
- 202401051001 (2024/1/5 中山1R)

## サポート情報

Ultimate版スクレイピングサービスの確認:
http://localhost:8001/health

Next.jsの確認:
http://localhost:3000

テストページ:
file:///C:/Users/yuki2/Documents/ws/keiba-ai-pro/test_page.html
